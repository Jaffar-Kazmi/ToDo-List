<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Application</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page">
        <header>
            <div class="navbar container">
                <h1>Task Manager</h1>
                <ul class="nav-menu">
                    <li><a href="#" id="show-login">Login</a></li>
                    <li><a href="#" id="show-register">Register</a></li>
                </ul>
            </div>
        </header>
        
        <main class="container">
            <div class="login-container">
                <h2>Login to Your Account</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-block">Login</button>
                </form>
                <p style="margin-top: 1rem; text-align: center;">
                    Don't have an account? <a href="#" id="link-to-register">Register now</a>
                </p>
            </div>
        </main>
    </div>
    
    <!-- Register Page -->
    <div id="register-page" style="display: none;">
        <header>
            <div class="navbar container">
                <h1>Task Manager</h1>
                <ul class="nav-menu">
                    <li><a href="#" id="show-login-from-register">Login</a></li>
                    <li><a href="#" id="show-register-from-register" class="active">Register</a></li>
                </ul>
            </div>
        </header>
        
        <main class="container">
            <div class="register-container">
                <h2>Create New Account</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirm Password</label>
                        <input type="password" id="register-confirm-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-block">Register</button>
                </form>
                <p style="margin-top: 1rem; text-align: center;">
                    Already have an account? <a href="#" id="link-to-login">Login now</a>
                </p>
            </div>
        </main>
    </div>
    
    <!-- Dashboard -->
    <div id="dashboard-page" style="display: none;">
        <header>
            <div class="navbar container">
                <h1>Task Manager</h1>
                <ul class="nav-menu">
                    <li><a href="#" class="active">Dashboard</a></li>
                    <li><a href="#" id="show-profile">Profile</a></li>
                    <li><a href="#" id="logout-btn">Logout</a></li>
                </ul>
            </div>
        </header>
        
        <main class="container">
            <div class="task-stats">
                <div class="stat-card stat-total">
                    <h3 id="total-tasks">0</h3>
                    <p>Total Tasks</p>
                </div>
                <div class="stat-card stat-completed">
                    <h3 id="completed-tasks">0</h3>
                    <p>Completed</p>
                </div>
                <div class="stat-card stat-pending">
                    <h3 id="pending-tasks">0</h3>
                    <p>Pending</p>
                </div>
                <div class="stat-card stat-overdue">
                    <h3 id="overdue-tasks">0</h3>
                    <p>Overdue</p>
                </div>
            </div>
            
            <div class="dashboard">
                <div class="sidebar">
                    <h3>Categories</h3>
                    <ul class="category-list" id="category-list">
                        <li><a href="#" class="active" data-category="all">All Tasks</a></li>
                        <li><a href="#" data-category="today">Today</a></li>
                        <li><a href="#" data-category="upcoming">Upcoming</a></li>
                        <li><a href="#" data-category="overdue">Overdue</a></li>
                        <li><a href="#" data-category="completed">Completed</a></li>
                    </ul>
                    
                    <h3>My Categories</h3>
                    <ul class="category-list" id="user-categories">
                        <!-- User categories will be loaded here -->
                    </ul>
                    
                    <button class="btn btn-block" id="add-category-btn">Add Category</button>
                </div>
                
                <div class="task-panel">
                    <div class="panel-header">
                        <h2 id="current-category-title">All Tasks</h2>
                        <div class="filter-options">
                            <div class="search-box">
                                <input type="text" id="search-input" placeholder="Search tasks...">
                                <button id="search-btn"><i class="fas fa-search"></i></button>
                            </div>
                            <select id="priority-filter" class="form-control">
                                <option value="">All Priorities</option>
                                <option value="1">Low</option>
                                <option value="2">Medium</option>
                                <option value="3">High</option>
                                <option value="4">Urgent</option>
                            </select>
                            <button class="btn" id="add-task-btn">Add Task</button>
                        </div>
                    </div>
                    
                    <ul class="task-list" id="task-list">
                        <!-- Tasks will be loaded here -->
                    </ul>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Add/Edit Task Modal -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="task-modal-title">Add New Task</h2>
                <button class="modal-close" id="close-task-modal">&times;</button>
            </div>
            <form id="task-form">
                <input type="hidden" id="task-id">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="task-due-date">Due Date</label>
                    <input type="date" id="task-due-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="task-priority">Priority</label>
                    <select id="task-priority" class="form-control">
                        <option value="1">Low</option>
                        <option value="2">Medium</option>
                        <option value="3">High</option>
                        <option value="4">Urgent</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-categories">Categories</label>
                    <select id="task-categories" class="form-control select-multiple" multiple>
                        <!-- Categories will be loaded here -->
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" style="background-color: #6c757d;" id="cancel-task-btn">Cancel</button>
                    <button type="submit" class="btn">Save Task</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Category Modal -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="category-modal-title">Add New Category</h2>
                <button class="modal-close" id="close-category-modal">&times;</button>
            </div>
            <form id="category-form">
                <input type="hidden" id="category-id">
                <div class="form-group">
                    <label for="category-name">Name</label>
                    <input type="text" id="category-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="category-color">Color</label>
                    <input type="color" id="category-color" class="form-control" value="#4a6fa5">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" style="background-color: #6c757d;" id="cancel-category-btn">Cancel</button>
                    <button type="submit" class="btn">Save Category</button>
                </div>
            </form>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Task Manager Application. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const registerPage = document.getElementById('register-page');
        const dashboardPage = document.getElementById('dashboard-page');
        
        const showLoginBtn = document.getElementById('show-login');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginFromRegisterBtn = document.getElementById('show-login-from-register');
        const linkToRegister = document.getElementById('link-to-register');
        const linkToLogin = document.getElementById('link-to-login');
        const logoutBtn = document.getElementById('logout-btn');
        
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        
        const addTaskBtn = document.getElementById('add-task-btn');
        const taskModal = document.getElementById('task-modal');
        const closeTaskModalBtn = document.getElementById('close-task-modal');
        const cancelTaskBtn = document.getElementById('cancel-task-btn');
        const taskForm = document.getElementById('task-form');
        
        const addCategoryBtn = document.getElementById('add-category-btn');
        const categoryModal = document.getElementById('category-modal');
        const closeCategoryModalBtn = document.getElementById('close-category-modal');
        const cancelCategoryBtn = document.getElementById('cancel-category-btn');
        const categoryForm = document.getElementById('category-form');
        
        const taskList = document.getElementById('task-list');
        const userCategories = document.getElementById('user-categories');
        const categoryList = document.getElementById('category-list');
        const currentCategoryTitle = document.getElementById('current-category-title');
        
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const priorityFilter = document.getElementById('priority-filter');
        
        // Statistics elements
        const totalTasksElement = document.getElementById('total-tasks');
        const completedTasksElement = document.getElementById('completed-tasks');
        const pendingTasksElement = document.getElementById('pending-tasks');
        const overdueTasksElement = document.getElementById('overdue-tasks');
        
        // Mock user data for demonstration
        let currentUser = null;
        const users = [
            { id: 1, username: 'demo', email: 'demo@example.com', password: 'demo123' }
        ];
        
        // Mock categories
        let categories = [
            { id: 1, name: 'Work', color: '#4a6fa5', userId: 1 },
            { id: 2, name: 'Personal', color: '#4fc08d', userId: 1 },
            { id: 3, name: 'Study', color: '#dc3545', userId: 1 },
            { id: 4, name: 'Health', color: '#28a745', userId: 1 }
        ];
        
        // Mock tasks
        let tasks = [
            { 
                id: 1, 
                title: 'Complete Database Project', 
                description: 'Finish the MySQL database design and implementation', 
                dueDate: '2025-05-25', 
                created: '2025-05-15', 
                completed: false, 
                userId: 1, 
                priorityId: 3,
                priority: 'High',
                categories: [1, 3] 
            },
            { 
                id: 2, 
                title: 'Go for a run', 
                description: 'Morning jog at the park', 
                dueDate: '2025-05-22', 
                created: '2025-05-16', 
                completed: false, 
                userId: 1, 
                priorityId: 2,
                priority: 'Medium',
                categories: [2, 4] 
            },
            { 
                id: 3, 
                title: 'Prepare presentation', 
                description: 'Create slides for project presentation', 
                dueDate: '2025-05-23', 
                created: '2025-05-17', 
                completed: true, 
                completedAt: '2025-05-19',
                userId: 1, 
                priorityId: 3,
                priority: 'High',
                categories: [1, 3] 
            }
        ];
        
        // Event Listeners for page navigation
        function showLogin() {
            loginPage.style.display = 'block';
            registerPage.style.display = 'none';
            dashboardPage.style.display = 'none';
        }
        
        function showRegister() {
            loginPage.style.display = 'none';
            registerPage.style.display = 'block';
            dashboardPage.style.display = 'none';
        }
        
        function showDashboard() {
            loginPage.style.display = 'none';
            registerPage.style.display = 'none';
            dashboardPage.style.display = 'block';
            loadTasks();
            loadCategories();
            updateTaskStatistics();
        }
        
        showLoginBtn.addEventListener('click', showLogin);
        showRegisterBtn.addEventListener('click', showRegister);
        showLoginFromRegisterBtn.addEventListener('click', showLogin);
        linkToRegister.addEventListener('click', showRegister);
        linkToLogin.addEventListener('click', showLogin);
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            showLogin();
        });
        
        // Login Form Submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            // Simple authentication for demo
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                showDashboard();
            } else {
                alert('Invalid username or password');
            }
        });
        
        // Register Form Submission
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (users.some(u => u.username === username)) {
                alert('Username already exists');
                return;
            }
            
            if (users.some(u => u.email === email)) {
                alert('Email already exists');
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                username,
                email,
                password
            };
            
            users.push(newUser);
            currentUser = newUser;
            showDashboard();
        });
        
        // Task Modal Functions
        function openTaskModal(taskId = null) {
            const modalTitle = document.getElementById('task-modal-title');
            const taskIdInput = document.getElementById('task-id');
            const taskTitleInput = document.getElementById('task-title');
            const taskDescriptionInput = document.getElementById('task-description');
            const taskDueDateInput = document.getElementById('task-due-date');
            const taskPriorityInput = document.getElementById('task-priority');
            const taskCategoriesInput = document.getElementById('task-categories');
            
            // Clear previous form data
            taskForm.reset();
            
            // Load categories into select
            taskCategoriesInput.innerHTML = '';
            categories.filter(c => c.userId === currentUser.id).forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                taskCategoriesInput.appendChild(option);
            });
            
            if (taskId) {
                // Edit existing task
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    modalTitle.textContent = 'Edit Task';
                    taskIdInput.value = task.id;
                    taskTitleInput.value = task.title;
                    taskDescriptionInput.value = task.description || '';
                    taskDueDateInput.value = task.dueDate || '';
                    taskPriorityInput.value = task.priorityId;
                    
                    // Select categories
                    Array.from(taskCategoriesInput.options).forEach(option => {
                        option.selected = task.categories.includes(parseInt(option.value));
                    });
                }
            } else {
                // Add new task
                modalTitle.textContent = 'Add New Task';
                taskIdInput.value = '';
            }
            
            taskModal.classList.add('active');
        }
        
        function closeTaskModal() {
            taskModal.classList.remove('active');
        }
        
        // Category Modal Functions
        function openCategoryModal(categoryId = null) {
            const modalTitle = document.getElementById('category-modal-title');
            const categoryIdInput = document.getElementById('category-id');
            const categoryNameInput = document.getElementById('category-name');
            const categoryColorInput = document.getElementById('category-color');
            
            // Clear previous form data
            categoryForm.reset();
            
            if (categoryId) {
                // Edit existing category
                const category = categories.find(c => c.id === categoryId);
                if (category) {
                    modalTitle.textContent = 'Edit Category';
                    categoryIdInput.value = category.id;
                    categoryNameInput.value = category.name;
                    categoryColorInput.value = category.color;
                }
            } else {
                // Add new category
                modalTitle.textContent = 'Add New Category';
                categoryIdInput.value = '';
                categoryColorInput.value = '#4a6fa5';
            }
            
            categoryModal.classList.add('active');
        }
        
        function closeCategoryModal() {
            categoryModal.classList.remove('active');
        }
        
        // Event listeners for modals
        addTaskBtn.addEventListener('click', () => openTaskModal());
        closeTaskModalBtn.addEventListener('click', closeTaskModal);
        cancelTaskBtn.addEventListener('click', closeTaskModal);
        
        addCategoryBtn.addEventListener('click', () => openCategoryModal());
        closeCategoryModalBtn.addEventListener('click', closeCategoryModal);
        cancelCategoryBtn.addEventListener('click', closeCategoryModal);
        
        // Form submissions
        taskForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const taskId = document.getElementById('task-id').value;
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const dueDate = document.getElementById('task-due-date').value;
            const priorityId = parseInt(document.getElementById('task-priority').value);
            const categoriesSelect = document.getElementById('task-categories');
            const selectedCategories = Array.from(categoriesSelect.selectedOptions).map(option => parseInt(option.value));
            
            // Get priority name
            let priorityName = '';
            switch(priorityId) {
                case 1: priorityName = 'Low'; break;
                case 2: priorityName = 'Medium'; break;
                case 3: priorityName = 'High'; break;
                case 4: priorityName = 'Urgent'; break;
            }
            
            if (taskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(t => t.id === parseInt(taskId));
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        description,
                        dueDate,
                        priorityId,
                        priority: priorityName,
                        categories: selectedCategories
                    };
                }
            } else {
                // Add new task
                const newTask = {
                    id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
                    title,
                    description,
                    dueDate,
                    created: new Date().toISOString().split('T')[0],
                    completed: false,
                    userId: currentUser.id,
                    priorityId,
                    priority: priorityName,
                    categories: selectedCategories
                };
                tasks.push(newTask);
            }
            
            closeTaskModal();
            loadTasks();
            updateTaskStatistics();
        });
        
        categoryForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const categoryId = document.getElementById('category-id').value;
            const name = document.getElementById('category-name').value;
            const color = document.getElementById('category-color').value;
            
            if (categoryId) {
                // Update existing category
                const categoryIndex = categories.findIndex(c => c.id === parseInt(categoryId));
                if (categoryIndex !== -1) {
                    categories[categoryIndex] = {
                        ...categories[categoryIndex],
                        name,
                        color
                    };
                }
            } else {
                // Add new category
                const newCategory = {
                    id: categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1,
                    name,
                    color,
                    userId: currentUser.id
                };
                categories.push(newCategory);
            }
            
            closeCategoryModal();
            loadCategories();
            loadTasks(); // Reload tasks to update category display
        });
        
        // Load user categories
        function loadCategories() {
            userCategories.innerHTML = '';
            
            categories.filter(c => c.userId === currentUser.id).forEach(category => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.dataset.categoryId = category.id;
                
                const colorSpan = document.createElement('span');
                colorSpan.className = 'category-color';
                colorSpan.style.backgroundColor = category.color;
                
                a.appendChild(colorSpan);
                a.appendChild(document.createTextNode(category.name));
                
                // Add edit and delete buttons
                const buttonsSpan = document.createElement('span');
                buttonsSpan.style.float = 'right';
                
                const editBtn = document.createElement('i');
                editBtn.className = 'fas fa-edit';
                editBtn.style.marginRight = '5px';
                editBtn.style.cursor = 'pointer';
                editBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    openCategoryModal(category.id);
                });
                
                const deleteBtn = document.createElement('i');
                deleteBtn.className = 'fas fa-trash';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (confirm(`Are you sure you want to delete category "${category.name}"?`)) {
                        // Remove category
                        categories = categories.filter(c => c.id !== category.id);
                        
                        // Remove category from tasks
                        tasks.forEach(task => {
                            if (task.categories.includes(category.id)) {
                                task.categories = task.categories.filter(id => id !== category.id);
                            }
                        });
                        
                        loadCategories();
                        loadTasks();
                    }
                });
                
                buttonsSpan.appendChild(editBtn);
                buttonsSpan.appendChild(deleteBtn);
                a.appendChild(buttonsSpan);
                
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    filterTasksByCategory(category.id, category.name);
                });
                
                li.appendChild(a);
                userCategories.appendChild(li);
            });
            
            // Load task categories filter
            const taskCategoriesFilter = document.getElementById('task-categories');
            if (taskCategoriesFilter) {
                taskCategoriesFilter.innerHTML = '';
                categories.filter(c => c.userId === currentUser.id).forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    taskCategoriesFilter.appendChild(option);
                });
            }
        }
        
        // Handle task filters
        categoryList.addEventListener('click', (e) => {
            e.preventDefault();
            if (e.target.tagName === 'A') {
                const category = e.target.dataset.category;
                filterTasks(category);
                
                // Update active class
                document.querySelectorAll('.category-list a').forEach(a => a.classList.remove('active'));
                e.target.classList.add('active');
            }
        });
        
        function filterTasks(filter) {
            let title = '';
            let filteredTasks = [];
            
            switch(filter) {
                case 'all':
                    title = 'All Tasks';
                    filteredTasks = tasks.filter(t => t.userId === currentUser.id);
                    break;
                case 'today':
                    title = 'Today\'s Tasks';
                    const today = new Date().toISOString().split('T')[0];
                    filteredTasks = tasks.filter(t => t.userId === currentUser.id && t.dueDate === today && !t.completed);
                    break;
                case 'upcoming':
                    title = 'Upcoming Tasks';
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const tomorrowStr = tomorrow.toISOString().split('T')[0];
                    filteredTasks = tasks.filter(t => 
                        t.userId === currentUser.id && 
                        t.dueDate >= tomorrowStr && 
                        !t.completed
                    );
                    break;
                case 'overdue':
                    title = 'Overdue Tasks';
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    filteredTasks = tasks.filter(t => 
                        t.userId === currentUser.id && 
                        t.dueDate <= yesterdayStr && 
                        !t.completed
                    );
                    break;
                case 'completed':
                    title = 'Completed Tasks';
                    filteredTasks = tasks.filter(t => t.userId === currentUser.id && t.completed);
                    break;
                default:
                    title = 'All Tasks';
                    filteredTasks = tasks.filter(t => t.userId === currentUser.id);
            }
            
            currentCategoryTitle.textContent = title;
            renderTasks(filteredTasks);
        }
        
        function filterTasksByCategory(categoryId, categoryName) {
            const filteredTasks = tasks.filter(t => 
                t.userId === currentUser.id && 
                t.categories.includes(categoryId)
            );
            currentCategoryTitle.textContent = `${categoryName} Tasks`;
            
            // Update active class
            document.querySelectorAll('.category-list a').forEach(a => a.classList.remove('active'));
            document.querySelector(`[data-category-id="${categoryId}"]`).classList.add('active');
            
            renderTasks(filteredTasks);
        }
        
        // Search functionality
        searchBtn.addEventListener('click', () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredTasks = tasks.filter(t => 
                t.userId === currentUser.id && 
                (t.title.toLowerCase().includes(searchTerm) || 
                 (t.description && t.description.toLowerCase().includes(searchTerm)))
            );
            
            currentCategoryTitle.textContent = `Search Results: "${searchInput.value}"`;
            renderTasks(filteredTasks);
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });
        
        // Priority filter
        priorityFilter.addEventListener('change', () => {
            loadTasks();
        });
        
        // Load and render tasks
        function loadTasks() {
            const priorityValue = priorityFilter.value;
            
            // Get active category/filter
            const activeFilter = document.querySelector('.category-list a.active');
            if (activeFilter) {
                const category = activeFilter.dataset.category;
                if (category) {
                    filterTasks(category);
                } else if (activeFilter.dataset.categoryId) {
                    const categoryId = parseInt(activeFilter.dataset.categoryId);
                    const category = categories.find(c => c.id === categoryId);
                    if (category) {
                        filterTasksByCategory(categoryId, category.name);
                    }
                }
            } else {
                // Default to all tasks
                filterTasks('all');
            }
        }
        
        function renderTasks(taskList) {
            const taskListElement = document.getElementById('task-list');
            taskListElement.innerHTML = '';
            
            const priorityValue = priorityFilter.value;
            let displayTasks = taskList;
            
            // Apply priority filter if selected
            if (priorityValue) {
                displayTasks = taskList.filter(t => t.priorityId === parseInt(priorityValue));
            }
            
            if (displayTasks.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'No tasks found';
                li.style.textAlign = 'center';
                li.style.padding = '2rem';
                li.style.color = '#777';
                taskListElement.appendChild(li);
                return;
            }
            
            displayTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `task-item ${task.completed ? 'completed' : ''}`;
                
                const taskContent = document.createElement('div');
                taskContent.className = 'task-content';
                
                const taskTitle = document.createElement('h3');
                taskTitle.className = 'task-title';
                taskTitle.textContent = task.title;
                
                const taskMeta = document.createElement('div');
                taskMeta.className = 'task-meta';
                
                if (task.dueDate) {
                    const dueDate = document.createElement('span');
                    dueDate.innerHTML = `<i class="far fa-calendar-alt"></i> ${task.dueDate}`;
                    taskMeta.appendChild(dueDate);
                }
                
                const priority = document.createElement('span');
                priority.className = `priority-badge priority-${task.priority.toLowerCase()}`;
                priority.textContent = task.priority;
                taskMeta.appendChild(priority);
                
                const taskCategories = document.createElement('div');
                taskCategories.className = 'task-categories';
                
                task.categories.forEach(catId => {
                    const category = categories.find(c => c.id === catId);
                    if (category) {
                        const categoryTag = document.createElement('span');
                        categoryTag.className = 'category-tag';
                        categoryTag.style.backgroundColor = category.color;
                        categoryTag.style.color = 'white';
                        categoryTag.textContent = category.name;
                        taskCategories.appendChild(categoryTag);
                    }
                });
                
                taskContent.appendChild(taskTitle);
                
                if (task.description) {
                    const taskDesc = document.createElement('p');
                    taskDesc.textContent = task.description.length > 100 ? 
                        task.description.substring(0, 100) + '...' : 
                        task.description;
                    taskContent.appendChild(taskDesc);
                }
                
                taskContent.appendChild(taskMeta);
                taskContent.appendChild(taskCategories);
                
                const taskActions = document.createElement('div');
                taskActions.className = 'task-actions';
                
                const completeBtn = document.createElement('button');
                completeBtn.className = 'btn-complete';
                completeBtn.innerHTML = task.completed ? 
                    '<i class="fas fa-undo"></i>' : 
                    '<i class="fas fa-check"></i>';
                completeBtn.title = task.completed ? 'Mark as incomplete' : 'Mark as complete';
                completeBtn.addEventListener('click', () => toggleTaskCompletion(task.id));
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn-edit';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.title = 'Edit task';
                editBtn.addEventListener('click', () => openTaskModal(task.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = 'Delete task';
                deleteBtn.addEventListener('click', () => deleteTask(task.id));
                
                taskActions.appendChild(completeBtn);
                taskActions.appendChild(editBtn);
                taskActions.appendChild(deleteBtn);
                
                li.appendChild(taskContent);
                li.appendChild(taskActions);
                
                taskListElement.appendChild(li);
            });
        }
        
        // Task operations
        function toggleTaskCompletion(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].completed = !tasks[taskIndex].completed;
                tasks[taskIndex].completedAt = tasks[taskIndex].completed ? 
                    new Date().toISOString() : null;
                
                loadTasks();
                updateTaskStatistics();
            }
        }
        
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                loadTasks();
                updateTaskStatistics();
            }
        }
        
        // Update task statistics
        function updateTaskStatistics() {
            const userTasks = tasks.filter(t => t.userId === currentUser.id);
            
            const totalTasks = userTasks.length;
            const completedTasks = userTasks.filter(t => t.completed).length;
            const overdueTasks = userTasks.filter(t => 
                !t.completed && 
                t.dueDate && 
                new Date(t.dueDate) < new Date().setHours(0,0,0,0)
            ).length;
            const pendingTasks = totalTasks - completedTasks - overdueTasks;
            
            totalTasksElement.textContent = totalTasks;
            completedTasksElement.textContent = completedTasks;
            pendingTasksElement.textContent = pendingTasks;
            overdueTasksElement.textContent = overdueTasks;
        }
        
        // Initialize with demo user for demonstration
        window.addEventListener('load', () => {
            // Automatically login as demo user for demonstration
            currentUser = users[0];
            showDashboard();
        });
    </script>